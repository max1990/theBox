{% extends "base.html" %}
{% block content %}
<div class="silvus-listener-page container mt-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">Silvus Listener</h2>
    <span class="badge bg-primary">Active</span>
  </div>

  <div class="card mb-4">
    <div class="card-header">
      Plugin Status
    </div>
    <div class="card-body">
      <p class="card-text">
        This plugin ingests Silvus AoA data and publishes
        <code>object.sighting.directional</code> (bearing-only) events.
      </p>
      <ul class="mb-0">
        <li><strong>Source:</strong> Silvus FASST radios (log replay now; live later)</li>
        <li><strong>Output:</strong> Bearings in degrees true (one per AoA lobe)</li>
        <li><strong>Confidence policy:</strong> Integer 0–100, default 75</li>
      </ul>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      Latest Bearings
    </div>
    <div class="card-body p-0">
      <table class="table table-striped table-sm mb-0">
        <thead class="table-light">
          <tr>
            <th>Time (UTC)</th>
            <th>Frequency (MHz)</th>
            <th>Bearing (° true)</th>
            <th>Error (°)</th>
            <th>Confidence</th>
          </tr>
        </thead>
        <tbody id="bearing-rows"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
async function fetchStatus() {
  try {
    const resp = await fetch("./status");
    if (!resp.ok) return;
    const data = await resp.json();
    const tbody = document.getElementById("bearing-rows");
    tbody.innerHTML = "";
    for (const ev of (data.last_bearings || [])) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${ev.time_utc}</td>
        <td>${ev.freq_mhz}</td>
        <td>${Number(ev.bearing_deg_true).toFixed(1)}</td>
        <td>${Number(ev.bearing_error_deg).toFixed(1)}</td>
        <td>${ev.confidence}</td>
      `;
      tbody.appendChild(tr);
    }
  } catch (e) { console.error(e); }
}
fetchStatus();
setInterval(fetchStatus, 2000);
</script>
{% endblock %}
