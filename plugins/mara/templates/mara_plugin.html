<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MARA Plugin - TheBox</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .status-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
        }
        .status-card h3 {
            margin: 0 0 10px 0;
            color: #495057;
        }
        .status-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 5px 0;
            border-bottom: 1px solid #e9ecef;
        }
        .status-item:last-child {
            border-bottom: none;
        }
        .status-label {
            font-weight: 500;
            color: #6c757d;
        }
        .status-value {
            color: #495057;
        }
        .status-value.connected {
            color: #28a745;
            font-weight: bold;
        }
        .status-value.disconnected {
            color: #dc3545;
            font-weight: bold;
        }
        .status-value.enabled {
            color: #28a745;
            font-weight: bold;
        }
        .status-value.disabled {
            color: #6c757d;
            font-weight: bold;
        }
        .refresh-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .refresh-btn:hover {
            background: #0056b3;
        }
        .log-container {
            margin-top: 20px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
        }
        .log-container h3 {
            margin: 0 0 10px 0;
            color: #495057;
        }
        .log-entry {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #495057;
            margin: 2px 0;
            padding: 2px 0;
            border-bottom: 1px solid #e9ecef;
        }
        .log-entry:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>MARA Plugin Status</h1>
        
        <button class="refresh-btn" onclick="refreshStatus()">Refresh Status</button>
        
        <div class="status-grid">
            <div class="status-card">
                <h3>Plugin Status</h3>
                <div class="status-item">
                    <span class="status-label">Enabled:</span>
                    <span class="status-value" id="enabled">-</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Running:</span>
                    <span class="status-value" id="running">-</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Input Mode:</span>
                    <span class="status-value" id="input_mode">-</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Queue Size:</span>
                    <span class="status-value" id="queue_size">-</span>
                </div>
            </div>
            
            <div class="status-card">
                <h3>Connection Status</h3>
                <div class="status-item">
                    <span class="status-label">UDP:</span>
                    <span class="status-value" id="udp_status">-</span>
                </div>
                <div class="status-item">
                    <span class="status-label">TCP:</span>
                    <span class="status-value" id="tcp_status">-</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Serial:</span>
                    <span class="status-value" id="serial_status">-</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Rebroadcast:</span>
                    <span class="status-value" id="rebroadcast_status">-</span>
                </div>
            </div>
            
            <div class="status-card">
                <h3>Configuration</h3>
                <div class="status-item">
                    <span class="status-label">UDP Config:</span>
                    <span class="status-value" id="udp_config">-</span>
                </div>
                <div class="status-item">
                    <span class="status-label">TCP Config:</span>
                    <span class="status-value" id="tcp_config">-</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Serial Config:</span>
                    <span class="status-value" id="serial_config">-</span>
                </div>
            </div>
        </div>
        
        <div class="log-container">
            <h3>Recent Activity</h3>
            <div id="log_entries">
                <div class="log-entry">Loading status...</div>
            </div>
        </div>
    </div>

    <script>
        function refreshStatus() {
            fetch('./status')
                .then(response => response.json())
                .then(data => {
                    // Update plugin status
                    document.getElementById('enabled').textContent = data.enabled ? 'Yes' : 'No';
                    document.getElementById('enabled').className = 'status-value ' + (data.enabled ? 'enabled' : 'disabled');
                    
                    document.getElementById('running').textContent = data.running ? 'Yes' : 'No';
                    document.getElementById('running').className = 'status-value ' + (data.running ? 'connected' : 'disconnected');
                    
                    document.getElementById('input_mode').textContent = data.input_mode.toUpperCase();
                    document.getElementById('queue_size').textContent = data.queue_size;
                    
                    // Update connection status
                    document.getElementById('udp_status').textContent = data.udp_connected ? 'Connected' : 'Disconnected';
                    document.getElementById('udp_status').className = 'status-value ' + (data.udp_connected ? 'connected' : 'disconnected');
                    
                    document.getElementById('tcp_status').textContent = data.tcp_connected ? 'Connected' : 'Disconnected';
                    document.getElementById('tcp_status').className = 'status-value ' + (data.tcp_connected ? 'connected' : 'disconnected');
                    
                    document.getElementById('serial_status').textContent = data.serial_connected ? 'Connected' : 'Disconnected';
                    document.getElementById('serial_status').className = 'status-value ' + (data.serial_connected ? 'connected' : 'disconnected');
                    
                    document.getElementById('rebroadcast_status').textContent = data.rebroadcast_enabled ? 'Enabled' : 'Disabled';
                    document.getElementById('rebroadcast_status').className = 'status-value ' + (data.rebroadcast_enabled ? 'enabled' : 'disabled');
                    
                    // Update configuration
                    document.getElementById('udp_config').textContent = data.udp_config;
                    document.getElementById('tcp_config').textContent = data.tcp_config;
                    document.getElementById('serial_config').textContent = data.serial_config;
                    
                    // Add log entry
                    const logContainer = document.getElementById('log_entries');
                    const timestamp = new Date().toLocaleTimeString();
                    const logEntry = document.createElement('div');
                    logEntry.className = 'log_entry';
                    logEntry.textContent = `[${timestamp}] Status refreshed - Running: ${data.running}, Queue: ${data.queue_size}`;
                    logContainer.insertBefore(logEntry, logContainer.firstChild);
                    
                    // Keep only last 10 log entries
                    while (logContainer.children.length > 10) {
                        logContainer.removeChild(logContainer.lastChild);
                    }
                })
                .catch(error => {
                    console.error('Error fetching status:', error);
                    const logContainer = document.getElementById('log_entries');
                    const timestamp = new Date().toLocaleTimeString();
                    const logEntry = document.createElement('div');
                    logEntry.className = 'log_entry';
                    logEntry.textContent = `[${timestamp}] Error fetching status: ${error.message}`;
                    logContainer.insertBefore(logEntry, logContainer.firstChild);
                });
        }
        
        // Auto-refresh every 5 seconds
        setInterval(refreshStatus, 5000);
        
        // Initial load
        refreshStatus();
    </script>
</body>
</html>
