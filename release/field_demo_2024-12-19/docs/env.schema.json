{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "TheBox Environment Configuration Schema",
  "description": "JSON Schema for validating TheBox environment variables",
  "type": "object",
  "properties": {
    "SECRET_KEY": {
      "type": "string",
      "description": "Flask application secret key for session management",
      "minLength": 1
    },
    "THEBOX_WEB_HOST": {
      "type": "string",
      "description": "Host address for the Flask web interface",
      "pattern": "^(0\\.0\\.0\\.0|127\\.0\\.0\\.1|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})$"
    },
    "THEBOX_WEB_PORT": {
      "type": "integer",
      "description": "Port for the Flask web interface",
      "minimum": 1,
      "maximum": 65535
    },
    "THEBOX_TALKER_ID": {
      "type": "string",
      "description": "NMEA talker ID for SeaCross messages",
      "pattern": "^[A-Z]{2}$"
    },
    "DB_PATH": {
      "type": "string",
      "description": "Path to the SQLite database file"
    },
    "BOW_ZERO_DEG": {
      "type": "number",
      "description": "Global bow zero offset in degrees",
      "minimum": 0,
      "maximum": 360
    },
    "DRONESHIELD_BEARING_OFFSET_DEG": {
      "type": "number",
      "description": "DroneShield bearing offset in degrees",
      "minimum": 0,
      "maximum": 360
    },
    "TRAKKA_BEARING_OFFSET_DEG": {
      "type": "number",
      "description": "Trakka bearing offset in degrees",
      "minimum": 0,
      "maximum": 360
    },
    "VISION_BEARING_OFFSET_DEG": {
      "type": "number",
      "description": "Vision bearing offset in degrees",
      "minimum": 0,
      "maximum": 360
    },
    "ACOUSTIC_BEARING_OFFSET_DEG": {
      "type": "number",
      "description": "Acoustic bearing offset in degrees",
      "minimum": 0,
      "maximum": 360
    },
    "DRONESHIELD_INPUT_FILE": {
      "type": "string",
      "description": "Path to DroneShield input file"
    },
    "DRONESHIELD_UDP_PORT": {
      "type": "integer",
      "description": "UDP port for DroneShield data",
      "minimum": 1,
      "maximum": 65535
    },
    "REPLAY_INTERVAL_MS": {
      "type": "integer",
      "description": "Replay interval in milliseconds",
      "minimum": 1
    },
    "SILVUS_UDP_HOST": {
      "type": "string",
      "description": "UDP host for Silvus data",
      "pattern": "^(0\\.0\\.0\\.0|127\\.0\\.0\\.1|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})$"
    },
    "SILVUS_UDP_PORT": {
      "type": "integer",
      "description": "UDP port for Silvus data",
      "minimum": 1,
      "maximum": 65535
    },
    "SILVUS_UDP_MODE": {
      "type": "string",
      "description": "Silvus UDP data mode",
      "enum": ["text", "protobuf"]
    },
    "SILVUS_REPLAY_PATH": {
      "type": "string",
      "description": "Path to Silvus replay file"
    },
    "MARA_ENABLE": {
      "type": "boolean",
      "description": "Enable MARA plugin"
    },
    "MARA_INPUT_MODE": {
      "type": "string",
      "description": "MARA input mode",
      "enum": ["udp", "tcp", "serial"]
    },
    "MARA_UDP_HOST": {
      "type": "string",
      "description": "MARA UDP host",
      "pattern": "^(0\\.0\\.0\\.0|127\\.0\\.0\\.1|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})$"
    },
    "MARA_UDP_PORT": {
      "type": "integer",
      "description": "MARA UDP port",
      "minimum": 1,
      "maximum": 65535
    },
    "MARA_TCP_HOST": {
      "type": "string",
      "description": "MARA TCP host",
      "pattern": "^(127\\.0\\.0\\.1|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})$"
    },
    "MARA_TCP_PORT": {
      "type": "integer",
      "description": "MARA TCP port",
      "minimum": 1,
      "maximum": 65535
    },
    "MARA_SERIAL_PORT": {
      "type": "string",
      "description": "MARA serial port"
    },
    "MARA_BAUD": {
      "type": "integer",
      "description": "MARA serial baud rate",
      "enum": [9600, 19200, 38400, 57600, 115200, 230400, 460800, 921600]
    },
    "MARA_HEARTBEAT_SEC": {
      "type": "integer",
      "description": "MARA heartbeat interval in seconds",
      "minimum": 1
    },
    "MARA_MAX_QUEUE": {
      "type": "integer",
      "description": "MARA maximum queue size",
      "minimum": 1
    },
    "DSPNOR_ENABLED": {
      "type": "boolean",
      "description": "Enable Dspnor plugin"
    },
    "DSPNOR_SAFE_MODE": {
      "type": "boolean",
      "description": "Enable Dspnor safe mode"
    },
    "DSPNOR_DISCOVERY_MULTICAST": {
      "type": "string",
      "description": "Dspnor discovery multicast address",
      "pattern": "^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$"
    },
    "DSPNOR_DISCOVERY_PORT": {
      "type": "integer",
      "description": "Dspnor discovery port",
      "minimum": 1,
      "maximum": 65535
    },
    "DSPNOR_INFO_TCP_PORT": {
      "type": "integer",
      "description": "Dspnor info TCP port",
      "minimum": 1,
      "maximum": 65535
    },
    "DSPNOR_CAT010_PROTO": {
      "type": "string",
      "description": "Dspnor CAT010 protocol",
      "enum": ["udp", "tcp"]
    },
    "DSPNOR_CAT010_HOST": {
      "type": "string",
      "description": "Dspnor CAT010 host",
      "pattern": "^(0\\.0\\.0\\.0|127\\.0\\.0\\.1|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})$"
    },
    "DSPNOR_CAT010_PORT": {
      "type": "integer",
      "description": "Dspnor CAT010 port",
      "minimum": 1,
      "maximum": 65535
    },
    "DSPNOR_STATUS_PROTO": {
      "type": "string",
      "description": "Dspnor status protocol",
      "enum": ["tcp", "udp"]
    },
    "DSPNOR_STATUS_HOST": {
      "type": "string",
      "description": "Dspnor status host",
      "pattern": "^(127\\.0\\.0\\.1|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})$"
    },
    "DSPNOR_STATUS_PORT": {
      "type": "integer",
      "description": "Dspnor status port",
      "minimum": 1,
      "maximum": 65535
    },
    "DSPNOR_NMEA_UDP_PORT": {
      "type": "integer",
      "description": "Dspnor NMEA UDP port",
      "minimum": 1,
      "maximum": 65535
    },
    "DSPNOR_INS_INJECT_ENABLED": {
      "type": "boolean",
      "description": "Enable Dspnor INS injection"
    },
    "DSPNOR_INS_INJECT_RATE_HZ": {
      "type": "integer",
      "description": "Dspnor INS injection rate in Hz",
      "minimum": 1
    },
    "DSPNOR_BEARING_IS_RELATIVE": {
      "type": "boolean",
      "description": "Dspnor bearings are relative to unit heading"
    },
    "DSPNOR_RANGE_UNITS": {
      "type": "string",
      "description": "Dspnor range units",
      "enum": ["m", "km", "nm", "ft", "yd"]
    },
    "DSPNOR_SPEED_UNITS": {
      "type": "string",
      "description": "Dspnor speed units",
      "enum": ["mps", "kph", "kts", "mph", "fps"]
    },
    "DSPNOR_CONF_MAP": {
      "type": "string",
      "description": "Dspnor confidence mapping"
    },
    "DSPNOR_MIN_CONF": {
      "type": "number",
      "description": "Dspnor minimum confidence",
      "minimum": 0,
      "maximum": 1
    },
    "DSPNOR_MAX_CONF": {
      "type": "number",
      "description": "Dspnor maximum confidence",
      "minimum": 0,
      "maximum": 1
    },
    "DSPNOR_BUFFER_BYTES": {
      "type": "integer",
      "description": "Dspnor buffer size in bytes",
      "minimum": 1024
    },
    "DSPNOR_CONNECT_TIMEOUT_SEC": {
      "type": "integer",
      "description": "Dspnor connection timeout in seconds",
      "minimum": 1
    },
    "DSPNOR_MAX_MSG_RATE_HZ": {
      "type": "integer",
      "description": "Dspnor maximum message rate in Hz",
      "minimum": 1
    },
    "DSPNOR_PUBLISH_TOPIC": {
      "type": "string",
      "description": "Dspnor publish topic"
    },
    "DSPNOR_REBROADCAST_UDP_PORT": {
      "type": "integer",
      "description": "Dspnor rebroadcast UDP port",
      "minimum": 0,
      "maximum": 65535
    },
    "DSPNOR_LOG_LEVEL": {
      "type": "string",
      "description": "Dspnor log level",
      "enum": ["DEBUG", "INFO", "WARNING", "ERROR", "CRITICAL"]
    },
    "DSPNOR_METRICS_PORT": {
      "type": "integer",
      "description": "Dspnor metrics port",
      "minimum": 0,
      "maximum": 65535
    },
    "DSPNOR_ALLOW_RESET": {
      "type": "boolean",
      "description": "Allow Dspnor reset"
    },
    "DSPNOR_ALLOW_REBOOT": {
      "type": "boolean",
      "description": "Allow Dspnor reboot"
    },
    "DSPNOR_UNIT_SERIAL": {
      "type": "string",
      "description": "Dspnor unit serial number"
    },
    "TRAKKA_DETECTION_MODE": {
      "type": "string",
      "description": "Trakka detection mode",
      "enum": ["builtin", "none", "ours"]
    },
    "CAMERA_CONNECTED": {
      "type": "boolean",
      "description": "Camera connection status"
    },
    "VISION_BACKEND": {
      "type": "string",
      "description": "Vision backend",
      "enum": ["onnxruntime", "cpu"]
    },
    "VISION_MODEL_PATH": {
      "type": "string",
      "description": "Path to vision model file"
    },
    "VISION_INPUT_RES": {
      "type": "integer",
      "description": "Vision input resolution",
      "enum": [320, 416, 512, 640, 896, 960]
    },
    "VISION_ROI_HALF_DEG": {
      "type": "number",
      "description": "Vision ROI half-width in degrees",
      "minimum": 0,
      "maximum": 180
    },
    "VISION_FRAME_SKIP": {
      "type": "integer",
      "description": "Frames to skip between analysis",
      "minimum": 0
    },
    "VISION_N_CONSEC_FOR_TRUE": {
      "type": "integer",
      "description": "Consecutive frames required for positive detection",
      "minimum": 1
    },
    "VISION_LATENCY_MS": {
      "type": "integer",
      "description": "Vision processing latency in milliseconds",
      "minimum": 50
    },
    "VISION_MAX_DWELL_MS": {
      "type": "integer",
      "description": "Maximum dwell time in milliseconds",
      "minimum": 1000
    },
    "VISION_SWEEP_STEP_DEG": {
      "type": "number",
      "description": "Sweep step in degrees",
      "minimum": 0,
      "maximum": 180
    },
    "VISION_PRIORITY": {
      "type": "string",
      "description": "Vision priority mode",
      "enum": ["EOfirst", "IRfirst", "balanced"]
    },
    "VISION_VERDICT_DEFAULT": {
      "type": "boolean",
      "description": "Default vision verdict"
    },
    "VISION_LABEL_DEFAULT": {
      "type": "string",
      "description": "Default vision label"
    },
    "CONFIDENCE_BASE": {
      "type": "number",
      "description": "Base confidence level",
      "minimum": 0,
      "maximum": 1
    },
    "CONFIDENCE_TRUE": {
      "type": "number",
      "description": "True detection confidence",
      "minimum": 0,
      "maximum": 1
    },
    "CONFIDENCE_FALSE": {
      "type": "number",
      "description": "False detection confidence",
      "minimum": 0,
      "maximum": 1
    },
    "CONF_FUSION_METHOD": {
      "type": "string",
      "description": "Confidence fusion method",
      "enum": ["bayes"]
    },
    "WEIGHT_RF": {
      "type": "number",
      "description": "RF weight for fusion",
      "minimum": 0
    },
    "WEIGHT_VISION": {
      "type": "number",
      "description": "Vision weight for fusion",
      "minimum": 0
    },
    "WEIGHT_IR": {
      "type": "number",
      "description": "IR weight for fusion",
      "minimum": 0
    },
    "WEIGHT_ACOUSTIC": {
      "type": "number",
      "description": "Acoustic weight for fusion",
      "minimum": 0
    },
    "CONF_HYSTERESIS": {
      "type": "number",
      "description": "Confidence hysteresis threshold",
      "minimum": 0,
      "maximum": 1
    },
    "RANGE_MODE": {
      "type": "string",
      "description": "Range estimation mode",
      "enum": ["RF", "EO", "IR", "ACOUSTIC", "HYBRID", "FIXED"]
    },
    "RANGE_FIXED_KM": {
      "type": "number",
      "description": "Fixed range in kilometers",
      "minimum": 0
    },
    "RANGE_RSSI_REF_DBM": {
      "type": "number",
      "description": "RSSI reference in dBm"
    },
    "RANGE_RSSI_REF_KM": {
      "type": "number",
      "description": "RSSI reference distance in km",
      "minimum": 0
    },
    "RANGE_MIN_KM": {
      "type": "number",
      "description": "Minimum range in kilometers",
      "minimum": 0
    },
    "RANGE_MAX_KM": {
      "type": "number",
      "description": "Maximum range in kilometers",
      "minimum": 0
    },
    "RANGE_EWMA_ALPHA": {
      "type": "number",
      "description": "EWMA smoothing factor",
      "minimum": 0,
      "maximum": 1
    },
    "EO_FOV_WIDE_DEG": {
      "type": "number",
      "description": "EO wide FOV in degrees",
      "minimum": 0,
      "maximum": 180
    },
    "EO_FOV_NARROW_DEG": {
      "type": "number",
      "description": "EO narrow FOV in degrees",
      "minimum": 0,
      "maximum": 180
    },
    "IR_FOV_WIDE_DEG": {
      "type": "number",
      "description": "IR wide FOV in degrees",
      "minimum": 0,
      "maximum": 180
    },
    "IR_FOV_NARROW_DEG": {
      "type": "number",
      "description": "IR narrow FOV in degrees",
      "minimum": 0,
      "maximum": 180
    },
    "SEACROSS_HOST": {
      "type": "string",
      "description": "SeaCross host IP or broadcast address",
      "pattern": "^(255\\.255\\.255\\.255|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})$"
    },
    "SEACROSS_PORT": {
      "type": "integer",
      "description": "SeaCross port number",
      "minimum": 1,
      "maximum": 65535
    },
    "THEBOX_BROADCAST_IP": {
      "type": "string",
      "description": "TheBox broadcast IP address",
      "pattern": "^(255\\.255\\.255\\.255|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})$"
    },
    "THEBOX_BROADCAST_PORT": {
      "type": "integer",
      "description": "TheBox broadcast port",
      "minimum": 1,
      "maximum": 65535
    },
    "THEBOX_MIN_SYNTH_RANGE_M": {
      "type": "number",
      "description": "Minimum synthetic range in meters",
      "minimum": 0
    },
    "THEBOX_MAX_SYNTH_RANGE_M": {
      "type": "number",
      "description": "Maximum synthetic range in meters",
      "minimum": 0
    },
    "THEBOX_DEFAULT_SYNTH_RANGE_M": {
      "type": "number",
      "description": "Default synthetic range in meters",
      "minimum": 0
    },
    "THEBOX_SYNTH_SMOOTHING_ALPHA": {
      "type": "number",
      "description": "Synthetic range smoothing alpha",
      "minimum": 0,
      "maximum": 1
    },
    "THEBOX_SYNTH_MIN_DIST_ERR_M": {
      "type": "number",
      "description": "Minimum synthetic distance error in meters",
      "minimum": 0
    },
    "THEBOX_SYNTH_DIST_ERR_FRAC": {
      "type": "number",
      "description": "Synthetic distance error fraction",
      "minimum": 0,
      "maximum": 1
    },
    "THEBOX_SYNTH_DEFAULT_BRG_ERR": {
      "type": "number",
      "description": "Default synthetic bearing error in degrees",
      "minimum": 0
    },
    "THEBOX_SYNTH_DEFAULT_ALT_M": {
      "type": "number",
      "description": "Default synthetic altitude in meters"
    },
    "THEBOX_SYNTH_DEFAULT_ALT_ERR": {
      "type": "number",
      "description": "Default synthetic altitude error in meters",
      "minimum": 0
    },
    "THEBOX_STATE_PATH": {
      "type": "string",
      "description": "Path to state file"
    },
    "THEBOX_STATE_SAVE_EVERY_SEC": {
      "type": "integer",
      "description": "State save interval in seconds",
      "minimum": 1
    },
    "TEST_DRY_RUN": {
      "type": "boolean",
      "description": "Test dry run mode"
    },
    "TEST_DEFAULT_BEARING_DEG": {
      "type": "number",
      "description": "Default test bearing in degrees",
      "minimum": 0,
      "maximum": 360
    },
    "TEST_DEFAULT_RSSI_DBM": {
      "type": "number",
      "description": "Default test RSSI in dBm"
    },
    "TEST_DEFAULT_NAME": {
      "type": "string",
      "description": "Default test name"
    },
    "TEST_DEFAULT_PROTOCOL": {
      "type": "string",
      "description": "Default test protocol"
    },
    "SETTINGS_PROTECT": {
      "type": "boolean",
      "description": "Enable settings protection"
    },
    "SETTINGS_PASSWORD": {
      "type": "string",
      "description": "Settings password"
    },
    "OUT_REBROADCAST_ENABLE": {
      "type": "boolean",
      "description": "Enable output rebroadcast"
    },
    "OUT_UDP_HOST": {
      "type": "string",
      "description": "Output UDP host",
      "pattern": "^(127\\.0\\.0\\.1|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})$"
    },
    "OUT_UDP_PORT": {
      "type": "integer",
      "description": "Output UDP port",
      "minimum": 1,
      "maximum": 65535
    }
  },
  "required": [
    "SECRET_KEY"
  ]
}
