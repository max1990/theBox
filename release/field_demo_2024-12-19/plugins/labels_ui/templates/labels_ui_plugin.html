<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>{% if mode == 'view' %}Track {{ tid }}{% else %}Tracks{% endif %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

{% if mode == 'index' %}
  <h2>Track list</h2>
  {% if not tracks %}
    <p>No tracks yet. When a CLS is sent, a track will appear here.</p>
  {% else %}
    <ul>
      {% for t in tracks %}
        <li>
          <a href="/drone/{{ t.tid }}">{{ t.tid }}</a>
          — {{ t.affiliation or 'UNKNOWN' }}
          {% if t.last_update %} ({{ t.last_update }}){% endif %}
        </li>
      {% endfor %}
    </ul>
  {% endif %}
{% else %}
  <h2>Track {{ tid }}</h2>
  <p><b>Affiliation:</b> {{ track.affiliation or 'UNKNOWN' }}</p>
  {% if track.details_url %}
    <p><b>Details URL:</b> <a href="{{ track.details_url }}" target="_blank">{{ track.details_url }}</a></p>
  {% endif %}

  <form method="post" action="/api/label/{{ tid }}">
    <button name="label" value="FRIENDLY">Friendly</button>
    <button name="label" value="ENEMY">Enemy</button>
    <button name="label" value="NOT_DRONE">Not Drone</button>
  </form>

  <hr>
  <h3>Recent Detections</h3>
  {% if dets %}
    <ul>
      {% for row in dets %}
        {% set d = row.get('Data', {}) %}
        <li>
          {{ d.get('TimeUTC') or row.get('time_utc') or '—' }}
          — {{ d.get('Vendor') or row.get('brand') or '' }}
          {{ d.get('UAType') or row.get('model') or '' }}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No recent detections recorded.</p>
  {% endif %}
{% endif %}

</body>
</html>
